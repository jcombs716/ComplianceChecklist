<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NY District Compliance Manager</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        function App() {
            const [activeView, setActiveView] = useState('checklist');
            const [expandedTaskId, setExpandedTaskId] = useState(null);
            const [selectedBuilding, setSelectedBuilding] = useState('High School');
            const [searchTerm, setSearchTerm] = useState('');
            const [notification, setNotification] = useState(null);

            const [buildings] = useState([
                "High School", "Middle School", "Elementary North", "Elementary South", "District Office"
            ]);

            const masterList = [
                { category: "Facilities", subcategory: "Structural", name: "Visual Inspection", frequency: "Annually", authority: "NYSED", action: "Inspection", performedBy: "Team (incl. Code Official)", citation: "8 NYCRR § 155.4" },
                { category: "Facilities", subcategory: "Structural", name: "Building Condition Survey (BCS)", frequency: "Every 5 Years", authority: "NYSED", action: "Survey & Report", performedBy: "Licensed Architect/PE", citation: "8 NYCRR § 155.4" },
                { category: "Facilities", subcategory: "Mechanical", name: "Boiler Inspection (High Pressure)", frequency: "Annual", authority: "NYS Dept of Labor", action: "Inspection", performedBy: "Authorized Inspector", citation: "Labor Law § 204" },
                { category: "Facilities", subcategory: "Water Systems", name: "Backflow Prevention Test", frequency: "Annual", authority: "NYS DOH", action: "Testing", performedBy: "Certified Tester", citation: "10 NYCRR § 5-1.31" },
                { category: "Fire Safety", subcategory: "General", name: "Annual Fire Safety Inspection", frequency: "Annually", authority: "NYSED / Fire Code", action: "Inspection", performedBy: "Code Enforcement Official", citation: "Ed. Law § 807-A" },
                { category: "Fire Safety", subcategory: "Drills", name: "Fire Evacuation Drills", frequency: "12x Year", authority: "NYSED", action: "Drill Execution", performedBy: "Principal / In-House", citation: "Ed. Law § 807" },
                { category: "Environmental", subcategory: "Water", name: "Lead in Water Testing", frequency: "Every 3 Years", authority: "NYS DOH", action: "Sampling & Lab Test", performedBy: "In-House / Lab", citation: "10 NYCRR § 67-4" },
                { category: "Health & Safety", subcategory: "Medical", name: "AED Inspection", frequency: "Monthly", authority: "NYSED", action: "Check Readiness", performedBy: "Nurse / Vendor", citation: "Ed. Law § 917" }
            ];

            const [tasks, setTasks] = useState(() => {
                const initialTasks = [];
                buildings.forEach(b => {
                    masterList.forEach((m, idx) => {
                        initialTasks.push({
                            ...m,
                            id: `${b}-${idx}`,
                            building: b,
                            attachments: [],
                            completed: false,
                            applicable: true
                        });
                    });
                });
                return initialTasks;
            });

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeView, selectedBuilding, expandedTaskId, tasks]);

            const showNotification = (message) => {
                setNotification(message);
                setTimeout(() => setNotification(null), 3000);
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            const handleFileUpload = (taskId) => {
                const fileName = prompt("Simulate upload - Enter filename (e.g. report.pdf):");
                if (!fileName) return;
                setTasks(tasks.map(t => t.id === taskId ? {
                    ...t,
                    attachments: [...t.attachments, { name: fileName, date: new Date().toLocaleDateString() }]
                } : t));
                showNotification("Document attached!");
            };

            const filteredTasks = tasks.filter(t => 
                t.building === selectedBuilding && 
                t.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const groupedTasks = filteredTasks.reduce((acc, task) => {
                if (!acc[task.category]) acc[task.category] = [];
                acc[task.category].push(task);
                return acc;
            }, {});

            return (
                <div className="flex h-screen bg-slate-50">
                    <aside className="w-64 bg-slate-900 text-slate-300 flex flex-col shrink-0">
                        <div className="p-6 border-b border-slate-800 flex items-center gap-3">
                            <Icon name="shield-check" size={28} className="text-indigo-400" />
                            <h1 className="font-bold text-white tracking-tight">NY Compliance</h1>
                        </div>
                        <div className="p-4 flex-1">
                            <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">Buildings</p>
                            {buildings.map(b => (
                                <button 
                                    key={b}
                                    onClick={() => setSelectedBuilding(b)}
                                    className={`w-full text-left px-3 py-2 rounded-lg text-sm mb-1 transition-all ${selectedBuilding === b ? 'bg-indigo-600 text-white font-bold' : 'hover:bg-slate-800'}`}
                                >
                                    {b}
                                </button>
                            ))}
                        </div>
                    </aside>

                    <main className="flex-1 overflow-y-auto">
                        <header className="bg-white border-b p-6 sticky top-0 z-10 flex justify-between items-center">
                            <h2 className="text-xl font-bold text-slate-800">{selectedBuilding} Status</h2>
                            <div className="relative">
                                <input 
                                    type="text" 
                                    placeholder="Search..." 
                                    className="pl-10 pr-4 py-2 bg-slate-100 rounded-lg text-sm outline-none w-64 focus:ring-2 focus:ring-indigo-500"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                                <Icon name="search" size={16} className="absolute left-3 top-2.5 text-slate-400" />
                            </div>
                        </header>

                        <div className="p-8 max-w-4xl mx-auto">
                            {notification && (
                                <div className="mb-4 p-3 bg-green-500 text-white rounded-lg text-sm font-bold animate-pulse">
                                    {notification}
                                </div>
                            )}

                            {Object.entries(groupedTasks).map(([category, items]) => (
                                <div key={category} className="mb-8">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                        {category} <span className="h-px flex-1 bg-slate-200"></span>
                                    </h3>
                                    <div className="space-y-2">
                                        {items.map(task => (
                                            <div key={task.id} className="bg-white border rounded-xl overflow-hidden shadow-sm">
                                                <div className="p-4 flex items-center gap-4 cursor-pointer" onClick={() => setExpandedTaskId(expandedTaskId === task.id ? null : task.id)}>
                                                    <button 
                                                        onClick={(e) => { e.stopPropagation(); toggleTask(task.id); }}
                                                        className={`w-6 h-6 rounded border-2 flex items-center justify-center ${task.completed ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-slate-200'}`}
                                                    >
                                                        {task.completed && <Icon name="check" size={14} />}
                                                    </button>
                                                    <div className="flex-1">
                                                        <p className={`font-semibold ${task.completed ? 'text-slate-400 line-through' : 'text-slate-800'}`}>{task.name}</p>
                                                        <p className="text-[10px] text-slate-400 uppercase font-bold">{task.frequency} • {task.citation}</p>
                                                    </div>
                                                    <Icon name={expandedTaskId === task.id ? "chevron-up" : "chevron-down"} size={16} className="text-slate-300" />
                                                </div>
                                                {expandedTaskId === task.id && (
                                                    <div className="px-14 pb-4 pt-0 text-sm text-slate-600">
                                                        <div className="bg-slate-50 p-3 rounded-lg flex justify-between items-center">
                                                            <div>
                                                                <p className="text-[10px] font-bold text-slate-400 uppercase">Requirement</p>
                                                                <p>{task.action} by {task.performedBy}</p>
                                                            </div>
                                                            <button 
                                                                onClick={() => handleFileUpload(task.id)}
                                                                className="text-xs font-bold text-indigo-600 bg-white border border-indigo-100 px-3 py-1.5 rounded-lg hover:bg-indigo-50 shadow-sm"
                                                            >
                                                                + Upload Proof
                                                            </button>
                                                        </div>
                                                        {task.attachments.length > 0 && (
                                                            <div className="mt-2 flex gap-2">
                                                                {task.attachments.map((f, i) => (
                                                                    <span key={i} className="text-[10px] bg-indigo-50 text-indigo-700 px-2 py-1 rounded border border-indigo-100 flex items-center gap-1 font-medium">
                                                                        <Icon name="file-text" size={10} /> {f.name}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
