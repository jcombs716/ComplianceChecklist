<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NY School Compliance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Firebase Mock/Initialize Logic for Single File
        // Note: In a real production build, you'd use the npm imports, 
        // but for a quick Vercel deployment via single file, we use the CDN approach or internal state.
        
        // --- DATA ---
        const MASTER_REQUIREMENTS = [
            { id: 'fire-1', name: 'Annual Fire Safety Inspection', category: 'Fire Safety', frequency: 'Annual', authority: 'NYSED' },
            { id: 'water-1', name: 'Lead in Water Testing', category: 'Environmental', frequency: '3 Years', authority: 'NYS DOH' },
            { id: 'bcs-1', name: 'Building Condition Survey', category: 'Facilities', frequency: '5 Years', authority: 'NYSED' },
            { id: 'boiler-1', name: 'Boiler Inspection', category: 'Mechanical', frequency: 'Annual', authority: 'Dept of Labor' },
            { id: 'visual-1', name: 'Annual Visual Inspection (AVI)', category: 'Facilities', frequency: 'Annual', authority: 'NYSED' }
        ];

        function App() {
            const [view, setView] = useState('checklist');
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [userData, setUserData] = useState(null); // null means show onboarding
            const [onboardForm, setOnboardForm] = useState({ name: '', district: '' });
            const [selectedBuilding, setSelectedBuilding] = useState('High School');
            const [tasks, setTasks] = useState([]);
            const [notif, setNotif] = useState(null);

            // Load local storage for demo persistence
            useEffect(() => {
                const savedUser = localStorage.getItem('ny_comp_user');
                const savedTasks = localStorage.getItem('ny_comp_tasks');
                if (savedUser) setUserData(JSON.parse(savedUser));
                if (savedTasks) setTasks(JSON.parse(savedTasks));
            }, []);

            useEffect(() => {
                if (userData) localStorage.setItem('ny_comp_user', JSON.stringify(userData));
                localStorage.setItem('ny_comp_tasks', JSON.stringify(tasks));
            }, [userData, tasks]);

            const showMsg = (txt) => {
                setNotif(txt);
                setTimeout(() => setNotif(null), 3000);
            };

            const handleOnboard = () => {
                if (!onboardForm.name || !onboardForm.district) return;
                setUserData({ ...onboardForm, buildings: ['High School', 'Middle School', 'Elementary School'] });
            };

            const addTask = (req) => {
                const id = Date.now();
                setTasks([...tasks, { ...req, id, building: selectedBuilding, completed: false }]);
                showMsg("Task added to " + selectedBuilding);
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            if (!userData) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-slate-100">
                        <div className="max-w-md w-full bg-white p-10 rounded-[2.5rem] shadow-2xl border border-white">
                            <div className="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-indigo-200">
                                <svg xmlns="http://www.w3.org/2000/svg" className="text-white w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
                            </div>
                            <h2 className="text-3xl font-extrabold text-slate-900 mb-2">NY Compliance</h2>
                            <p className="text-slate-500 mb-8">Initialize your district dashboard.</p>
                            <div className="space-y-4">
                                <input className="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 ring-indigo-500" placeholder="Your Name" value={onboardForm.name} onChange={e => setOnboardForm({...onboardForm, name: e.target.value})} />
                                <input className="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none focus:ring-2 ring-indigo-500" placeholder="District Name" value={onboardForm.district} onChange={e => setOnboardForm({...onboardForm, district: e.target.value})} />
                                <button onClick={handleOnboard} className="w-full py-4 bg-indigo-600 text-white font-bold rounded-2xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all">Get Started</button>
                            </div>
                        </div>
                    </div>
                );
            }

            const currentTasks = tasks.filter(t => t.building === selectedBuilding);

            return (
                <div className="flex h-screen bg-[#F8FAFC]">
                    {/* Sidebar */}
                    <aside className={`w-72 bg-slate-950 flex flex-col fixed inset-y-0 z-50 transition-transform md:relative md:translate-x-0 ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="p-8 flex-1">
                            <div className="text-white font-bold text-xl flex items-center gap-3 mb-10">
                                <div className="w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center text-xs">NY</div>
                                <div className="truncate text-sm">
                                    <div className="text-indigo-400 text-[10px] uppercase font-black">{userData.district}</div>
                                    <div className="text-slate-200">{userData.name}</div>
                                </div>
                            </div>
                            <nav className="space-y-2">
                                <button onClick={() => setView('checklist')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold ${view === 'checklist' ? 'bg-indigo-600 text-white' : 'text-slate-400 hover:bg-white/5'}`}>
                                    Dashboard
                                </button>
                                <button onClick={() => setView('library')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold ${view === 'library' ? 'bg-indigo-600 text-white' : 'text-slate-400 hover:bg-white/5'}`}>
                                    Library
                                </button>
                            </nav>
                        </div>
                        <div className="p-6">
                            <button onClick={() => {localStorage.clear(); location.reload();}} className="text-slate-500 text-[10px] uppercase font-black tracking-widest hover:text-white transition-all">Reset Session</button>
                        </div>
                    </aside>

                    {/* Main */}
                    <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
                        <header className="h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="md:hidden">Menu</button>
                                <h1 className="font-bold text-slate-800">{view === 'checklist' ? 'Compliance Tracker' : 'Requirement Library'}</h1>
                            </div>
                            <select className="bg-slate-100 p-2 rounded-xl text-xs font-bold outline-none" value={selectedBuilding} onChange={e => setSelectedBuilding(e.target.value)}>
                                {userData.buildings.map(b => <option key={b}>{b}</option>)}
                            </select>
                        </header>

                        <main className="flex-1 overflow-y-auto p-8 relative">
                            {notif && (
                                <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest z-50">
                                    {notif}
                                </div>
                            )}

                            <div className="max-w-4xl mx-auto">
                                {view === 'checklist' ? (
                                    <div className="space-y-3">
                                        {currentTasks.length === 0 ? (
                                            <div className="text-center p-20 border-2 border-dashed border-slate-200 rounded-[2rem]">
                                                <p className="text-slate-400 font-bold">No tasks added to {selectedBuilding}</p>
                                                <button onClick={() => setView('library')} className="text-indigo-600 text-xs font-bold mt-2">Open Library</button>
                                            </div>
                                        ) : (
                                            currentTasks.map(t => (
                                                <div key={t.id} className="bg-white p-6 rounded-3xl border border-slate-200 flex items-center gap-4">
                                                    <button onClick={() => toggleTask(t.id)} className={`w-8 h-8 rounded-lg border-2 flex items-center justify-center ${t.completed ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-slate-100 bg-slate-50'}`}>
                                                        {t.completed && "âœ“"}
                                                    </button>
                                                    <div>
                                                        <h4 className={`text-sm font-bold ${t.completed ? 'line-through text-slate-400' : 'text-slate-800'}`}>{t.name}</h4>
                                                        <p className="text-[10px] text-indigo-500 font-bold uppercase tracking-widest">{t.authority}</p>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {MASTER_REQUIREMENTS.map(req => (
                                            <div key={req.id} className="bg-white p-8 rounded-[2rem] border border-slate-200 flex flex-col justify-between hover:shadow-xl transition-all">
                                                <div>
                                                    <span className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full uppercase tracking-widest">{req.category}</span>
                                                    <h3 className="text-lg font-bold text-slate-800 mt-4 leading-tight">{req.name}</h3>
                                                </div>
                                                <button onClick={() => addTask(req)} className="mt-6 py-3 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-indigo-600 transition-all">Add to {selectedBuilding}</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
